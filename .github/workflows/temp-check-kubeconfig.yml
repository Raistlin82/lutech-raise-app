name: TEMP - Check Kubeconfig Structure

on:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
    - name: Configure kubeconfig
      run: |
        mkdir -p ~/.kube
        echo "${{ secrets.KYMA_KUBECONFIG }}" | base64 -d > ~/.kube/config
        chmod 600 ~/.kube/config

    - name: Show kubeconfig structure (no secrets)
      run: |
        echo "=== Kubeconfig Structure ==="
        # Show structure without sensitive data
        cat ~/.kube/config | grep -E "^[a-z]|^  [a-z]|^    [a-z]|^      [a-z]" | grep -v "token:" | grep -v "certificate-authority-data:" | grep -v "client-certificate-data:" | grep -v "client-key-data:"

        echo ""
        echo "=== Auth Type Check ==="
        if grep -q "exec:" ~/.kube/config; then
          echo "Uses EXEC auth (oidc-login)"
          grep -A2 "exec:" ~/.kube/config | head -5
        elif grep -q "token:" ~/.kube/config; then
          echo "Uses TOKEN auth (service account)"
        else
          echo "Unknown auth type"
        fi
